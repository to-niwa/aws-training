## VPC Peering vs Transit Gateway

- 「多くの VPC を接続」「複数アカウント」「接続制御が必要」の場合は Transit Gateway を利用する。

| 比較項目             | VPC Peering                                  | Transit Gateway                               |
| -------------------- | -------------------------------------------- | --------------------------------------------- |
| 通信方式             | **ポイント・ツー・ポイント**                 | **ハブアンドスポーク**                        |
| スケーラビリティ     | 最大 125 接続/VPC（フルメッシュが煩雑）      | 数千 VPC まで接続可能                         |
| ルート伝播           | 手動でルート追加                             | 自動またはルートテーブルで制御可能            |
| CIDR の重複          | 不可（重複 CIDR は接続不可）                 | 不可（同様に重複 CIDR 禁止）                  |
| クロスリージョン     | 対応（リージョン間ピアリング）               | 対応（TGW ピアリングが必要）                  |
| トラフィックの中継   | 不可（**トランジティブルーティング非対応**） | 可（**中継可能：ハブとして機能**）            |
| セキュリティ制御     | セキュリティグループ/ACL で個別に管理        | TGW ルートテーブルで集中制御                  |
| コスト               | 軽微（データ転送料金＋無料接続）             | **アタッチメント単位で課金**（転送量も）      |
| AWS 試験での使い分け | **2 ～ 3VPC の直結用途に推奨**               | **数十以上の VPC や複数アカウントの集約用途** |

### ユースケース

| シナリオ例                     | 正解となる構成候補            |
| ------------------------------ | ----------------------------- |
| 2 つの VPC を簡単に接続したい  | VPC Peering                   |
| 20 以上の VPC を中央管理したい | Transit Gateway               |
| クロスアカウントで接続したい   | Transit Gateway（RAM と併用） |
| 特定 VPC だけ通信可能にしたい  | TGW + ルートテーブル制御      |
| A→B→C という中継通信が必要     | Transit Gateway               |

## Direct Connect vs Site-to-Site VPN

- 「フェイルオーバーを自動化したい」→ BGP ルーティングを使用
- 「セキュアかつ安定した回線を使いたい」→ DX + VPN 冗長

| 比較項目             | Site-to-Site VPN                        | AWS Direct Connect                              |
| -------------------- | --------------------------------------- | ----------------------------------------------- |
| 通信方式             | インターネット経由の IPSec VPN トンネル | 専用物理線（L2 接続）                           |
| レイテンシ / 信頼性  | 高レイテンシ / 変動あり                 | 低レイテンシ / 高信頼性                         |
| 帯域幅               | 最大 1.25Gbps 程度（実効）              | 最大 10Gbps（複数リンクで拡張可）               |
| セットアップ期間     | 即時〜数時間                            | 数日〜数週間（回線敷設が必要）                  |
| セキュリティ         | 通信は IPSec で暗号化                   | 専用線＋必要に応じて VPN 併用（暗号なしが基本） |
| 可用性向上手段       | 冗長 VPN（2 本まで）                    | 冗長構成：**DX + VPN バックアップ構成推奨**     |
| コスト               | 低コスト（トラフィック料金のみ）        | 高コスト（専用回線＋ポート課金）                |
| 主な用途             | 一時的 / 小規模接続                     | 長期 / 安定した大規模接続                       |
| 試験での正解選択基準 | **短期/可用性優先**                     | **高帯域/専用回線/ミッションクリティカル**      |

### シナリオ

| シナリオ                                         | 推奨サービス                     | 理由                                     |
| ------------------------------------------------ | -------------------------------- | ---------------------------------------- |
| **数時間〜数日の短期接続が必要**                 | Site-to-Site VPN                 | すぐに使える、コスト安                   |
| **高帯域・レイテンシ重視（金融など）**           | Direct Connect                   | 信頼性・専用線                           |
| **Direct Connect 障害時のバックアップ回線**      | Site-to-Site VPN                 | 試験頻出パターン（フェイルオーバー構成） |
| **ハイブリッド環境（オンプレ＋ AWS）を安定接続** | Direct Connect + VPN（冗長構成） | 可用性・耐障害性の両立                   |

## AWS PrivateLink 概要

### 目的

- AWS サービスまたは**自社/他社サービスへの通信を VPC 内のプライベートネットワークで完結**させるための仕組み

### 特徴

- **パブリック IP も NAT Gateway も不要**
- **サービス提供者と利用者が VPC ピアリングなしで接続可能**
- **エンドポイントが VPC 内の ENI（Elastic Network Interface）として提供**
- **セキュアでスケーラブルな通信**

### 主な構成要素

| コンポーネント                   | 役割                                  |
| -------------------------------- | ------------------------------------- |
| **VPC Endpoint Service**         | サービス提供側が作成（NLB が背後）    |
| **VPC Endpoint（Interface 型）** | 利用側が作成、VPC 内に ENI として登場 |

### VPC Peering との違い

| 比較項目           | PrivateLink                       | VPC Peering                     |
| ------------------ | --------------------------------- | ------------------------------- |
| 接続対象           | 特定サービス（NLB 背後）          | VPC 全体（IP レベル）           |
| CIDR 重複          | **OK（重複しても接続可）**        | NG（CIDR が重複すると使えない） |
| 通信方向           | クライアント → サービス（片方向） | 双方向                          |
| ルーティング必要性 | 不要（ENI に直接接続）            | 必要（ルートテーブルに追加）    |
| ユースケース       | SaaS や特定サービスの公開/接続    | 同じ会社内でのフル VPC 通信     |

### シナリオ

| シナリオ                                    | 選ぶべき構成                        |
| ------------------------------------------- | ----------------------------------- |
| SaaS 提供者が安全にサービスを提供したい     | VPC Endpoint Service（PrivateLink） |
| 他社 VPC 内の NLB をプライベート接続したい  | Interface Endpoint（PrivateLink）   |
| VPC 間でリソースすべてをやり取りしたい      | VPC Peering                         |
| S3 にインターネットを使わずにアクセスしたい | Gateway Endpoint                    |

## EC2 接続手段の比較

| 手段                 | 特徴                                   | 鍵管理             | VPC 内ポート | インターネット経由         | 試験キーワード                 |
| -------------------- | -------------------------------------- | ------------------ | ------------ | -------------------------- | ------------------------------ |
| SSM Session Manager  | **ポート開放・キーペア不要、IAM 制御** | 不要（IAM で制御） | 不要         | 不要（VPC 内通信）         | セキュリティ重視、監査ログ     |
| EC2 Instance Connect | ブラウザから一時的に接続（公開鍵）     | 自動生成（短期）   | 22 番ポート  | **必要**（SSH over HTTPS） | SSH 公開鍵管理、簡易接続       |
| SSH（通常の鍵接続）  | 手動で秘密鍵管理                       | 手動（PEM 管理）   | 22 番ポート  | **必要**                   | 鍵紛失・セキュリティリスクあり |

### SSM Session Manager

| 特徴             | 内容                                                                 |
| ---------------- | -------------------------------------------------------------------- |
| 接続方法         | Systems Manager の Session Manager 経由（CLI or Console）            |
| ネットワーク要件 | **インターネット不要、ポートも不要**（SSM Agent が HTTPS 通信）      |
| IAM 制御         | **IAM ポリシーでアクセス制御**可能（例：EC2 への ssm\:StartSession） |
| ログ             | CloudWatch Logs や S3 に接続ログを出力できる（試験頻出）             |
| 利用条件         | - SSM Agent インストール済み<br> - SSM に必要な IAM ロールを付与     |

### EC2 Instance Connect

| 特徴             | 内容                                                         |
| ---------------- | ------------------------------------------------------------ |
| 接続方法         | AWS Console からブラウザベースで SSH 接続                    |
| ネットワーク要件 | **22 番ポートを開ける必要あり**                              |
| 鍵管理           | 一時公開鍵を EC2 に送信（自動的に 5 分だけ有効）             |
| 利用条件         | - Amazon Linux 2/Ubuntu 対応<br> - Cloud-init で一時鍵を受信 |

### シナリオ

| シナリオ                                       | 選ぶべき接続方式                        | 理由                 |
| ---------------------------------------------- | --------------------------------------- | -------------------- |
| セキュリティ監査のために接続ログを記録したい   | SSM Session Manager                     | CloudWatch Logs 対応 |
| 鍵を配布せずに一時的な接続をしたい             | EC2 Instance Connect                    | ブラウザ接続・一時鍵 |
| オンプレから閉域 VPC 上の EC2 にログインしたい | SSM Session Manager                     | インターネット不要   |
| SSH 秘密鍵が漏洩するリスクを回避したい         | SSM Session Manager or Instance Connect | 鍵管理不要・IAM 制御 |
