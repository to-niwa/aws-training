## データベースタイプと特徴一覧（RDBMS/NoSQL）

| 種類      | 一貫性     | 可用性     | レイテンシ | スケーラビリティ | クエリ機能        | 主なユースケース                   |
| --------- | ---------- | ---------- | ---------- | ---------------- | ----------------- | ---------------------------------- |
| RDBMS     | 強い       | 高い       | 中         | 垂直/限定的      | 高度（JOIN など） | 業務システム、財務、CRM            |
| Key-Value | 弱め〜可選 | 非常に高い | 非常に低い | 水平分散         | なし（Key のみ）  | セッション、キャッシュ、ユーザ情報 |
| Document  | 一貫性選択 | 高い       | 低〜中     | 水平分散         | JSON クエリ       | コンテンツ管理、モバイルアプリ     |
| Columnar  | 一貫性選択 | 高い       | 中         | 水平分散         | 高速集計          | BI/ログ分析、データウェアハウス    |
| GraphDB   | 強い       | 高い       | 中〜高     | 水平分散困難     | グラフ探索専用    | SNS、推薦システム、アクセス権      |
| 時系列 DB | 一貫性選択 | 高い       | 低〜中     | 水平分散         | 時系列特化        | IoT、モニタリング、メトリクス管理  |

## Key-Value DB のユースケース

- ユーザセッション、カート情報、トークンなどの**高速取得が重要なシナリオ**
- 読み書きが頻繁だが**構造が単純なデータ**
- TTL 付きの短命データや、**キャッシュ用途**

## GraphDB のユースケース

- ソーシャルグラフ（例：フォロー関係）
- ネットワーク構成のトポロジー（例：ルーティング、パーミッション継承）
- 推薦システム（「この人がフォローしている人がいいねした投稿」などの**複雑なリレーション探索**）

## パフォーマンス・可用性向上の仕組み

| 仕組み                 | 説明                                                     |
| ---------------------- | -------------------------------------------------------- |
| **リードレプリカ**     | 読み込み負荷分散用。RDS, Aurora, DynamoDB 対応           |
| **マルチ AZ 配置**     | 可用性向上（RDS, DynamoDB, Neptune など）                |
| **オートスケーリング** | 書き込み/読み込みスループットを自動調整（DynamoDB など） |
| **キャッシュ層**       | ElastiCache（Redis/Memcached）を使用してレイテンシ削減   |
| **CDN + キャッシュ**   | グローバル分散キャッシュ（CloudFront + Lambda@Edge）     |
| **インメモリ DB**      | Redis（セッション・ランキング）、DAX（DynamoDB 向け）    |

## AWS サービス例（分類）

| 種類       | サービス名         |
| ---------- | ------------------ |
| RDBMS      | Amazon RDS, Aurora |
| Key-Value  | Amazon DynamoDB    |
| Document   | Amazon DocumentDB  |
| Columnar   | Amazon Redshift    |
| GraphDB    | Amazon Neptune     |
| 時系列 DB  | Amazon Timestream  |
| キャッシュ | Amazon ElastiCache |

## Amazon RDS Proxy 概要

### 目的

- RDS や Aurora に対する**データベース接続の最適化・安定化・セキュリティ向上**

### 特徴

- DB 接続の**コネクションプーリング**によりスケーラビリティ向上
- DB フェイルオーバー時の**接続切断を最小化**
- IAM 認証や Secrets Manager 連携で**セキュアな接続管理**
- **サーバレス（Lambda）や高同時接続アプリケーション**に最適

### 対応 DB エンジン

- Amazon RDS（MySQL / PostgreSQL）
- Amazon Aurora（MySQL / PostgreSQL）

### 主なユースケース

- Lambda + RDS 構成（大量の同時接続抑制）
- スケーラブルな Web API バックエンド
- DB 接続に IAM 認証を使いたい場合

### メリット

- コネクション管理が自動（アプリ側は意識不要）
- RDS フェイルオーバー後も**自動再接続**
- RDS のスロット数制限による接続拒否を緩和

### 注意点

- 書き込みは**単一の書き込みエンドポイント**経由（マルチマスタは不可）
- パフォーマンスは**低レイテンシ要件には不向き**
- SQL トランザクション中の接続はプール不可（トランザクションは継続接続）

## DynamoDB キャパシティモード比較

| モード名       | 特徴                                     | スケーリング             | コストモデル         | 試験での選定ポイント               |
| -------------- | ---------------------------------------- | ------------------------ | -------------------- | ---------------------------------- |
| オンデマンド   | トラフィックに応じて自動スケール         | 自動（秒単位）           | リクエストベース課金 | **アクセスパターン不明 or 変動大** |
| プロビジョンド | RCU/WCU を手動または Auto Scaling で設定 | 手動 or 自動（設定必要） | キャパシティ単位課金 | **トラフィック予測可能 or 固定**   |

### シナリオ

| シナリオ                        | 適切なモード                  | 理由                           |
| ------------------------------- | ----------------------------- | ------------------------------ |
| 不定期なアクセスピークあり      | オンデマンド                  | スパイク対応、自動スケーリング |
| 毎時 1000req 固定のトラフィック | プロビジョンド                | コスト最適、予測可能           |
| 小規模サービス、初期段階        | オンデマンド                  | 設定不要、立ち上げが簡単       |
| 高スループットを継続的に使用    | プロビジョンド + Auto Scaling | 安定した性能制御とコスト最適化 |

## Redis vs Memcached 比較表

| 項目             | Redis                                  | Memcached                          |
| ---------------- | -------------------------------------- | ---------------------------------- |
| データ構造       | **豊富（List, Hash, Set, SortedSet）** | キー・バリュー（単純な文字列のみ） |
| 永続化           | あり（AOF/RDB）                        | なし（メモリのみ）                 |
| Pub/Sub          | あり                                   | なし                               |
| トランザクション | あり（MULTI/EXEC）                     | なし                               |
| レプリケーション | あり（マスター/レプリカ構成）          | なし                               |
| クラスタリング   | あり（Redis Cluster）                  | あり（クライアント側で分散制御）   |
| メモリ管理       | LRU/TTL/Maxmemory など柔軟             | LRU/TTL のみ（オプション少）       |
| パフォーマンス   | 高速（マルチスレッドではないが高速）   | **超高速**（マルチスレッド対応）   |
| AWS マネージド   | ElastiCache for Redis                  | ElastiCache for Memcached          |

### Redis を使うべきシナリオ

| シナリオ例                     | 理由                                    |
| ------------------------------ | --------------------------------------- |
| Web セッション管理             | データ構造が複雑なため（Hash 構造など） |
| ランキング表示（スコア順）     | Sorted Set が使える                     |
| Pub/Sub でイベント連携         | Redis が対応している                    |
| 永続化・フェイルオーバーが必要 | Redis は RDB/AOF ＋レプリカ対応         |
| キューやジョブ処理             | List 構造＋ POP/PUSH 操作が便利         |

### Memcached を使うべきシナリオ

| シナリオ例                     | 理由                                 |
| ------------------------------ | ------------------------------------ |
| DB キャッシュとして一時保存    | 高速＆単純な Key-Value で十分        |
| 読み取り専用の Web アセット    | 永続化不要、超高速アクセス重視       |
| メモリコストを最小化したい場合 | メモリ効率が高い（オーバーヘッド少） |
| スケールアウトの自由度を重視   | クライアントベースの分散構成が軽い   |

### シナリオ

| シナリオ                                | 選択すべきキャッシュ |
| --------------------------------------- | -------------------- |
| 永続化が必要 / 冗長構成が必要           | ✅ Redis             |
| セッションやランキングを保存            | ✅ Redis             |
| シンプルな K-V キャッシュ、高速が最優先 | ✅ Memcached         |
| 構成の簡易さ・スケーラビリティが重要    | ✅ Memcached         |
